pipeline {
    agent any
    environment {
        NODEJS_HOME = tool name: 'NodeJS-20.13.1', type: 'jenkins.plugins.nodejs.tools.NodeJSInstallation'
    }
    stages{
        stage("charts Clone"){
            steps{
                script{
                    sh "rm -rf ./charts"
                    sh "git clone https://github.com/Harsha190202/charts.git -b ${env.ChartsBranch}"
    
                }
            }
        }
        stage("Front-end clone") {
            steps{
                script{
                    sh "rm -rf ./mocktest-frontend"
                    sh "git clone https://github.com/Harsha190202/mocktest-frontend.git -b ${env.FrontendBranch}"
                }
            }
        }

        stage("frontend-dependencies and build"){
            steps{
                dir("./mocktest-frontend/"){
                    sh "rm -rf /node-modules"
                    sh "${NODEJS_HOME}/bin/npm install"
                    sh "${NODEJS_HOME}/bin/npm run build"
                }
                }
        }

        stage("Docker Build") {
            steps {
                dir("./mocktest-frontend/"){
                script{
                    sh "aws ecr get-login-password --region ap-south-1 --profile shared-s3 | docker login --username AWS --password-stdin 112606330682.dkr.ecr.ap-south-1.amazonaws.com"
                    sh "docker build -f applications/mocktest-frontend -t mocktest-frontend ." 
                    sh "docker tag mocktest-frontend:latest "
                    sh "docker push"
                }
            }
            }
        }

        
        stage("Deployment") {
            steps {
                dir("/CHARTS/") {
                    script{
                        sh "sed command"
                    }
                }
            }
        }
        
    }

}


