pipeline {
    agent any
    environment {
        NODE_VERSION = '20.13.1' 
    }
    stages{
        stage("charts Clone"){
            steps{
                script{
                    sh "rm -rf ./charts"
                    sh "git clone https://github.com/Harsha190202/charts.git -b ${env.ChartsBranch}"
    
                }
            }
        }
        stage("Front-end clone") {
            steps{
                script{
                    sh "rm -rf ./mocktest-frontend"
                    sh "git clone https://github.com/Harsha190202/mocktest-frontend.git -b ${env.FrontendBranch}"
                }
            }
        }

        stage('Setup Node.js') {
            steps {
                script {
                    sh '''
                        curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash
                        source ~/.nvm/nvm.sh
                        nvm install $NODE_VERSION
                        nvm use $NODE_VERSION
                        node -v
                        npm -v
                    '''
                }
            }
        }
        stage("frontend-dependencies"){
            steps{
                dir("./mocktest-frontend/"){
                    script{
                        sh "rm -rf node_modules"
                        sh "npm cache clean --force"
                        sh "npm install"
                    }
                }
            }
        }
        stage("front-end-build"){
            steps {
                dir("./mocktest-frontend/"){
                    script{
                        sh "npm run build --verbose"
                    }
                }
            }
        }
        stage("Docker Build") {
            steps {
                dir("./mocktest-frontend/"){
                script{
                    sh "aws ecr get-login-password --region ap-south-1 --profile shared-s3 | docker login --username AWS --password-stdin 112606330682.dkr.ecr.ap-south-1.amazonaws.com"
                    sh "docker build -f applications/mocktest-frontend -t mocktest-frontend ." 
                    sh "docker tag mocktest-frontend:latest "
                    sh "docker push"
                }
            }
            }
        }

        
        stage("Deployment") {
            steps {
                dir("/CHARTS/") {
                    script{
                        sh "sed command"
                    }
                }
            }
        }
        
    }

}


